# å¡”é˜²æ¸¸æˆæ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ—ï¸ æ•´ä½“æ¶æ„è®¾è®¡

### æ¶æ„åŸåˆ™
- **å•ä¸€èŒè´£åŸåˆ™**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šåŠŸèƒ½
- **å¼€é—­åŸåˆ™**ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­
- **ä¾èµ–æ³¨å…¥**ï¼šæ¨¡å—é—´é€šè¿‡æ¥å£äº¤äº’ï¼Œé™ä½è€¦åˆ
- **é…ç½®é©±åŠ¨**ï¼šæ¸¸æˆå‚æ•°å¯é…ç½®ï¼Œä¾¿äºè°ƒæ•´å’Œæ‰©å±•

### æ ¸å¿ƒæ¶æ„å±‚çº§
```
åº”ç”¨å±‚ (Application Layer)
â”œâ”€â”€ æ¸¸æˆæ§åˆ¶å™¨ (GameController)
â””â”€â”€ UIæ§åˆ¶å™¨ (UIController)

ä¸šåŠ¡å±‚ (Business Layer)  
â”œâ”€â”€ æ¸¸æˆé€»è¾‘ (GameLogic)
â”œâ”€â”€ æˆ˜æ–—ç³»ç»Ÿ (CombatSystem)
â”œâ”€â”€ å…ƒç´ ç³»ç»Ÿ (ElementSystem)
â”œâ”€â”€ æˆå°±ç³»ç»Ÿ (AchievementSystem)
â””â”€â”€ éŸ³æ•ˆç³»ç»Ÿ (AudioSystem)

æ•°æ®å±‚ (Data Layer)
â”œâ”€â”€ æ¸¸æˆçŠ¶æ€ (GameState)
â”œâ”€â”€ é…ç½®ç®¡ç† (ConfigManager)
â””â”€â”€ äº‹ä»¶ç³»ç»Ÿ (EventSystem)

æ¸²æŸ“å±‚ (Render Layer)
â”œâ”€â”€ æ¸²æŸ“å¼•æ“ (RenderEngine)
â”œâ”€â”€ ç‰¹æ•ˆç³»ç»Ÿ (EffectSystem)
â””â”€â”€ UIæ¸²æŸ“å™¨ (UIRenderer)

å·¥å…·å±‚ (Utility Layer)
â”œâ”€â”€ æ•°å­¦å·¥å…· (MathUtils)
â”œâ”€â”€ å‡ ä½•å·¥å…· (GeometryUtils)
â””â”€â”€ éšæœºå·¥å…· (RandomUtils)
```

## ğŸ“ ç›®å½•ç»“æ„è®¾è®¡

```
src/
â”œâ”€â”€ core/                    # æ ¸å¿ƒç³»ç»Ÿ
â”‚   â”œâ”€â”€ GameController.js    # æ¸¸æˆä¸»æ§åˆ¶å™¨
â”‚   â”œâ”€â”€ GameState.js         # æ¸¸æˆçŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ EventSystem.js       # äº‹ä»¶ç³»ç»Ÿ
â”‚   â””â”€â”€ ConfigManager.js     # é…ç½®ç®¡ç†å™¨
â”‚
â”œâ”€â”€ systems/                 # æ¸¸æˆç³»ç»Ÿ
â”‚   â”œâ”€â”€ combat/              # æˆ˜æ–—ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ CombatSystem.js  # æˆ˜æ–—ä¸»é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ BulletManager.js # å­å¼¹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ CollisionDetector.js # ç¢°æ’æ£€æµ‹
â”‚   â”‚   â””â”€â”€ DamageCalculator.js  # ä¼¤å®³è®¡ç®—
â”‚   â”‚
â”‚   â”œâ”€â”€ elements/            # å…ƒç´ ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ ElementSystem.js # å…ƒç´ ä¸»ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ ElementManager.js # å…ƒç´ ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ElementEffects.js # å…ƒç´ æ•ˆæœ
â”‚   â”‚   â””â”€â”€ ElementConfig.js  # å…ƒç´ é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ entities/            # å®ä½“ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ Player.js        # ç©å®¶å®ä½“
â”‚   â”‚   â”œâ”€â”€ Dragon.js        # é¾™å®ä½“
â”‚   â”‚   â”œâ”€â”€ Tower.js         # å¡”å®ä½“
â”‚   â”‚   â””â”€â”€ Projectile.js    # æŠ•å°„ç‰©å®ä½“
â”‚   â”‚
â”‚   â”œâ”€â”€ achievements/        # æˆå°±ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ AchievementSystem.js # æˆå°±ä¸»ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ AchievementManager.js # æˆå°±ç®¡ç†
â”‚   â”‚   â””â”€â”€ AchievementConfig.js  # æˆå°±é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ audio/               # éŸ³æ•ˆç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ AudioSystem.js   # éŸ³æ•ˆä¸»ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ SoundManager.js  # å£°éŸ³ç®¡ç†
â”‚   â”‚   â””â”€â”€ AudioConfig.js   # éŸ³æ•ˆé…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ spawn/               # ç”Ÿæˆç³»ç»Ÿ
â”‚       â”œâ”€â”€ SpawnSystem.js   # ç”Ÿæˆä¸»é€»è¾‘
â”‚       â”œâ”€â”€ WaveManager.js   # æ³¢æ¬¡ç®¡ç†
â”‚       â””â”€â”€ DragonSpawner.js # é¾™ç”Ÿæˆå™¨
â”‚
â”œâ”€â”€ rendering/               # æ¸²æŸ“ç³»ç»Ÿ
â”‚   â”œâ”€â”€ RenderEngine.js      # æ¸²æŸ“å¼•æ“
â”‚   â”œâ”€â”€ ParticleSystem.js    # ç²’å­ç³»ç»Ÿ
â”‚   â”œâ”€â”€ EffectRenderer.js    # ç‰¹æ•ˆæ¸²æŸ“å™¨
â”‚   â”œâ”€â”€ UIRenderer.js        # UIæ¸²æŸ“å™¨
â”‚   â””â”€â”€ AnimationSystem.js   # åŠ¨ç”»ç³»ç»Ÿ
â”‚
â”œâ”€â”€ ui/                      # ç”¨æˆ·ç•Œé¢
â”‚   â”œâ”€â”€ HUD.js              # æ¸¸æˆç•Œé¢
â”‚   â”œâ”€â”€ MenuSystem.js       # èœå•ç³»ç»Ÿ
â”‚   â”œâ”€â”€ InfoPanel.js        # ä¿¡æ¯é¢æ¿
â”‚   â””â”€â”€ NotificationSystem.js # é€šçŸ¥ç³»ç»Ÿ
â”‚
â”œâ”€â”€ utils/                   # å·¥å…·ç±»
â”‚   â”œâ”€â”€ MathUtils.js        # æ•°å­¦å·¥å…·
â”‚   â”œâ”€â”€ GeometryUtils.js    # å‡ ä½•å·¥å…·
â”‚   â”œâ”€â”€ RandomUtils.js      # éšæœºå·¥å…·
â”‚   â”œâ”€â”€ TimerUtils.js       # è®¡æ—¶å·¥å…·
â”‚   â””â”€â”€ ColorUtils.js       # é¢œè‰²å·¥å…·
â”‚
â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ GameConfig.js       # æ¸¸æˆé…ç½®
â”‚   â”œâ”€â”€ ElementConfig.js    # å…ƒç´ é…ç½®
â”‚   â”œâ”€â”€ AudioConfig.js      # éŸ³æ•ˆé…ç½®
â”‚   â””â”€â”€ BalanceConfig.js    # å¹³è¡¡æ€§é…ç½®
â”‚
â””â”€â”€ game.js                 # ä¸»å…¥å£æ–‡ä»¶ï¼ˆä¿æŒå…¼å®¹æ€§ï¼‰
```

## ğŸ”§ æ¨¡å—æ¥å£è®¾è®¡

### æ ¸å¿ƒæ¨¡å—æ¥å£

#### GameController
```javascript
class GameController {
    // æ ¸å¿ƒæ–¹æ³•
    start()               // å¼€å§‹æ¸¸æˆ
    pause()               // æš‚åœæ¸¸æˆ
    resume()              // æ¢å¤æ¸¸æˆ
    restart()             // é‡å¯æ¸¸æˆ
    stop()                // åœæ­¢æ¸¸æˆ
    
    // çŠ¶æ€ç®¡ç†
    getState()            // è·å–æ¸¸æˆçŠ¶æ€
    setState(state)       // è®¾ç½®æ¸¸æˆçŠ¶æ€
    
    // äº‹ä»¶å¤„ç†
    handleInput(input)    // å¤„ç†è¾“å…¥
    update(deltaTime)     // æ›´æ–°é€»è¾‘
    render()              // æ¸²æŸ“ç”»é¢
}
```

#### EventSystem
```javascript
class EventSystem {
    // äº‹ä»¶æ³¨å†Œ
    on(event, callback)      // æ³¨å†Œäº‹ä»¶ç›‘å¬
    off(event, callback)     // ç§»é™¤äº‹ä»¶ç›‘å¬
    once(event, callback)    // ä¸€æ¬¡æ€§äº‹ä»¶ç›‘å¬
    
    // äº‹ä»¶è§¦å‘
    emit(event, data)        // è§¦å‘äº‹ä»¶
    emitAsync(event, data)   // å¼‚æ­¥è§¦å‘äº‹ä»¶
    
    // äº‹ä»¶ç®¡ç†
    clear()                  // æ¸…é™¤æ‰€æœ‰äº‹ä»¶
    hasListener(event)       // æ£€æŸ¥æ˜¯å¦æœ‰ç›‘å¬å™¨
}
```

## ğŸ“Š æ•°æ®æµè®¾è®¡

### æ¸¸æˆå¾ªç¯æ•°æ®æµ
```
Input â†’ EventSystem â†’ GameController â†’ Systems â†’ GameState â†’ Renderer â†’ Output
```

### äº‹ä»¶é©±åŠ¨æ¶æ„
```
ç”¨æˆ·æ“ä½œ â†’ UIäº‹ä»¶ â†’ æ¸¸æˆé€»è¾‘äº‹ä»¶ â†’ ç³»ç»Ÿå“åº” â†’ çŠ¶æ€æ›´æ–° â†’ UIæ›´æ–°
```

## ğŸ¯ æ‰©å±•ç‚¹è®¾è®¡

### 1. æ–°å…ƒç´ ç±»å‹æ‰©å±•
- åœ¨ `ElementConfig.js` ä¸­æ·»åŠ æ–°å…ƒç´ é…ç½®
- åœ¨ `ElementEffects.js` ä¸­å®ç°æ–°å…ƒç´ æ•ˆæœ
- è‡ªåŠ¨é›†æˆåˆ°ç°æœ‰ç³»ç»Ÿä¸­

### 2. æ–°å®ä½“ç±»å‹æ‰©å±•
- ç»§æ‰¿åŸºç¡€ `Entity` ç±»
- å®ç°ç‰¹å®šçš„ `update()` å’Œ `render()` æ–¹æ³•
- æ³¨å†Œåˆ°å¯¹åº”çš„ç®¡ç†å™¨ä¸­

### 3. æ–°ç³»ç»Ÿæ‰©å±•
- å®ç°æ ‡å‡†çš„ç³»ç»Ÿæ¥å£
- æ³¨å†Œåˆ° `GameController` ä¸­
- é€šè¿‡äº‹ä»¶ç³»ç»Ÿä¸å…¶ä»–ç³»ç»Ÿé€šä¿¡

## âš™ï¸ é…ç½®ç®¡ç†

### é…ç½®å±‚çº§
1. **é»˜è®¤é…ç½®** - ç¡¬ç¼–ç çš„åŸºç¡€é…ç½®
2. **ç¯å¢ƒé…ç½®** - ä¸åŒç¯å¢ƒçš„é…ç½®è¦†ç›–
3. **ç”¨æˆ·é…ç½®** - ç”¨æˆ·è‡ªå®šä¹‰é…ç½®
4. **è¿è¡Œæ—¶é…ç½®** - æ¸¸æˆè¿è¡Œä¸­çš„åŠ¨æ€é…ç½®

### é…ç½®æ›´æ–°ç­–ç•¥
- çƒ­é‡è½½æ”¯æŒ
- é…ç½®éªŒè¯æœºåˆ¶
- é…ç½®ç‰ˆæœ¬ç®¡ç†
- é…ç½®å›æ»šæ”¯æŒ

è¿™ä¸ªæ¶æ„è®¾è®¡ç¡®ä¿äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œå¯æµ‹è¯•æ€§ï¼Œä¸ºåç»­å¼€å‘æä¾›äº†æ¸…æ™°çš„æŒ‡å¯¼ã€‚
